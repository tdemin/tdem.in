<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono" rel="stylesheet"> 
        <title>Recoverable 2FA Token HOWTO - Timur Demin&#39;s Blog</title>
        <link rel="stylesheet" href="https://tdem.in/main.min.e362aa227211af09a948971525eec203b612c527d03a62e7ddaa6c3ac14d5ed4.css">
        <link rel="alternate" type="application/rss+xml" href="/index.xml">
        <meta property="og:title" content="Recoverable 2FA Token HOWTO" />
<meta property="og:description" content="So you want to enable two-factor authentication for your online accounts? That’s
fairly easy, made relatively painless by Google with its Authenticator.
Well, enabling 2FA isn’t the problem. There are other caveats to watch out for." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tdem.in/post/recoverable-2fa-token-howto/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2017-10-27T12:00:00+00:00" />
<meta property="article:modified_time" content="2017-10-27T12:00:00+00:00" />

        <link rel="me" href="https://github.com/tdemin">
        <link rel="webmention" href="https://webmention.io/tdem.in/webmention">
        <link rel="pingback" href="https://webmention.io/tdem.in/xmlrpc">
    </head>
    <body>
        <div class="container-horizontal">
        <nav class="navbar-top">
            <a class="navbar-top__item" href="/">Home</a>
            <a class="navbar-top__item" href="/projects">Projects</a>
            <a class="navbar-top__item" href="/post">Blog</a>
            <a class="navbar-top__item" href="/index.xml">RSS</a>
            <a class="navbar-top__item" href="/blog_index">Index</a>
        </nav>
        


<article>
    <h1>Recoverable 2FA Token HOWTO</h1>
    <time class="bold" datetime="2017-10-27T12:00:00">27 Oct 2017</time>

    <main>
        <p>So you want to enable two-factor authentication for your online accounts? That’s
fairly easy, made relatively painless by Google with its <a href="https://support.google.com/accounts/answer/1066447?co=GENIE.Platform%3DAndroid&amp;amp;hl=en">Authenticator</a>.
Well, enabling 2FA isn’t the problem. There are other caveats to watch out for.</p>
<p>First of all, <em>you can’t back up your token</em>. There isn’t an option for moving
your keys to another device, your only option is to use so-called recovery codes
that are meant to be entered if the token is lost. Google suggests to write
those codes somewhere in a safe place, and most of the other services who offer
2FA do. But well, this means storing those codes in an insecure way.</p>
<p>Another problem is directly pointed out from the first one: <em>you can’t generate
codes with multiple devices</em>. Changing device in most 2FA systems means your
previous phone will no longer generate codes that work.</p>
<p>And last, but not the least: <em>you can’t get your private keys back</em> after
they’re saved on your device. Neither you can edit them. Yes, this is a security
measure, but what a headache this actually is!</p>
<p>Some 2FA apps realizing these constraints make 2FA much harder to enforce tried
to address those issues. At least <a href="https://authy.com">Authy</a> allows for multiple code
generators, and it also makes backups of the keys in the cloud, so you can
easily restore those on your new device. The thing is, storing keys in cloud
negates security, as not only someone has your codes, but this also introduces
another attack vector. What if that cloud is hacked?</p>
<p>This is exactly what I’ve tried to overcome.</p>
<hr>
<p>So, let’s proceed to the practical part. We want all of those:</p>
<ul>
<li>multiple devices that generate codes;</li>
<li>private key backups;</li>
<li>easy restoration of the codes on new devices;</li>
<li>adding the keys to the device with scanning the code.</li>
</ul>
<p>And we also don’t want to harm our accounts’ security.</p>
<p>The only sustainable way of doing this is storing the private keys in a secure
place. With your PC, this means creating an encrypted container that would hold
our private key material. I shall not explain the whole process of creating the
container, I’ll just point you to <a href="https://www.veracrypt.fr/en/Home.html">VeraCrypt</a>, an excellent program
for doing exactly that. Probably the only recommendation to consider: your
container doesn’t need to be that big, 2MB should be enough so far as we’ll just
store a plain text file with keys in it.</p>
<p>Next, we’ll enable two-factor authentication, just in a little bit different
way. Don’t scan the QR code, select &ldquo;I can’t scan the code&rdquo; or whatever and then
copy the code to the text file placed in your container.</p>
<p>Now we’ll do some magic on the code. The QR codes made to scan with your 2FA app
are not generated with the super cow powers, they are just modified a little so
your device instantly recognizes the name of your 2FA provider and the options
to use. We’ll just form the codes we can scan using the same
<a href="https://github.com/google/google-authenticator/wiki/Key-Uri-Format">algorithm</a>. Just make the strings containing your keys look like
this:</p>
<p><code>otpauth://totp/SiteName:AccountName?secret=PRIVATEKEY</code></p>
<p>And ensure that the string contains no spaces. The <code>:AccountName</code> part is
optional and can be omitted. Do this with all your codes.</p>
<p>Now we have the codes, time to generate the QR codes that can be scanned! Get
any free app that generates QR codes (I used <a href="https://code.google.com/archive/p/qrencode-win32/">this one</a>) and generate
the codes from the strings you’ve resulted with in the previous step. Scan them
one-by-one with Google Authenticator.</p>
<p>You’re done! You now have your private keys that are backed up in a secure
manner. You can also add those to another app or device if you want. And, of
course, you can add them without hassling with entering the keys by hand. All of
these without having your accounts compromised.</p>
    </main>
    
    <section>
        <span class="bold">Tags:</span>
        <ul class="tags">
        <li class="tag"><a href="https://tdem.in/tags/two-factor-authentication/">two-factor authentication</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/security/">security</a></li>
        
        </ul>
    </section>
    
</article>

        <footer>
            <hr>
            <small>
                <p>
                    &copy; 2024 <a href="https://tdem.in">Timur Demin</a>.
                    Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> using a theme based on
                    <a href="https://github.com/arjunkrishnababu96/basics" target="_blank">Basics</a>.
                </p>
                <p>
                    All content on this page is licensed under a <a rel="license" href="/LICENSE">Creative Commons Attribution
                        4.0 International License</a>, unless noticed otherwise.
                </p>
                
                <p>
                    The source code of this website is available <a target="_blank" href="https://github.com/tdemin/tdem.in">here</a>.
                </p>
                
            </small>
        </footer>
        
        </div>
    </body>
</html>
