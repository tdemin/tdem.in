<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono" rel="stylesheet"> 
        <title>Removing duplicate files with PowerShell - Timur Demin&#39;s Blog</title>
        <link rel="stylesheet" href="https://tdem.in/main.min.e362aa227211af09a948971525eec203b612c527d03a62e7ddaa6c3ac14d5ed4.css">
        <link rel="alternate" type="application/rss+xml" href="/index.xml">
        <meta property="og:title" content="Removing duplicate files with PowerShell" />
<meta property="og:description" content="Well, I finally decided to clean up the files from my storage drive.
I found a lot of duplicate files unnecessarily taking up my storage space. As
looking through every single file on your hard disk is a tedious job, I wrote a
little PowerShell script to assist me with that." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tdem.in/post/dedupe-files-powershell/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-12-02T22:02:37+05:00" />
<meta property="article:modified_time" content="2019-12-02T22:02:37+05:00" />

        <link rel="me" href="https://github.com/tdemin">
        <link rel="webmention" href="https://webmention.io/tdem.in/webmention">
        <link rel="pingback" href="https://webmention.io/tdem.in/xmlrpc">
    </head>
    <body>
        <div class="container-horizontal">
        <nav class="navbar-top">
            <a class="navbar-top__item" href="/">Home</a>
            <a class="navbar-top__item" href="/projects">Projects</a>
            <a class="navbar-top__item" href="/post">Blog</a>
            <a class="navbar-top__item" href="/index.xml">RSS</a>
            <a class="navbar-top__item" href="/blog_index">Index</a>
        </nav>
        


<article>
    <h1>Removing duplicate files with PowerShell</h1>
    <time class="bold" datetime="2019-12-02T22:02:37">02 Dec 2019</time>

    <main>
        <p>Well, I finally decided to clean up the files from my storage drive.</p>
<p>I found a lot of duplicate files unnecessarily taking up my storage space. As
looking through every single file on your hard disk is a tedious job, I wrote a
little PowerShell script to assist me with that.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ps1" data-lang="ps1"><span style="display:flex;"><span>[CmdletBinding()]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">param</span> (
</span></span><span style="display:flex;"><span>    [Parameter()]
</span></span><span style="display:flex;"><span>    [<span style="color:#66d9ef">string</span>]
</span></span><span style="display:flex;"><span>    $dir
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (!$dir) {
</span></span><span style="display:flex;"><span>    $dir = Get-Location
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> File {
</span></span><span style="display:flex;"><span>    [<span style="color:#66d9ef">string</span>]$Hash
</span></span><span style="display:flex;"><span>    [<span style="color:#66d9ef">string</span>]$FileName
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> Duplicate {
</span></span><span style="display:flex;"><span>    [<span style="color:#66d9ef">string</span>]$Orig
</span></span><span style="display:flex;"><span>    [<span style="color:#66d9ef">string</span>]$Dupe
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$files = @()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> ($file <span style="color:#66d9ef">in</span> Get-ChildItem -Path $dir -Recurse <span style="color:#f92672">-File</span> | Select-Object -ExpandProperty FullName) {
</span></span><span style="display:flex;"><span>    $f = [<span style="color:#66d9ef">File</span>]::new()
</span></span><span style="display:flex;"><span>    $f.FileName = $file
</span></span><span style="display:flex;"><span>    $f.Hash = Get-FileHash -Path $file -Algorithm <span style="color:#e6db74">&#34;SHA1&#34;</span> | Select-Object -ExpandProperty Hash
</span></span><span style="display:flex;"><span>    $files += $f
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$dupes = @()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ($i = <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">-lt</span> $files.Count; $i++) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> ($j = $i; $j <span style="color:#f92672">-lt</span> $files.Count; $j++) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($files[$i].Hash <span style="color:#f92672">-eq</span> $files[$j].Hash <span style="color:#f92672">-And</span> $files[$i].FileName <span style="color:#f92672">-ne</span> $files[$j].FileName) {
</span></span><span style="display:flex;"><span>            $f = [<span style="color:#66d9ef">Duplicate</span>]::new()
</span></span><span style="display:flex;"><span>            $f.Orig = $files[$i].FileName
</span></span><span style="display:flex;"><span>            $f.Dupe = $files[$j].FileName
</span></span><span style="display:flex;"><span>            $dupes += $f
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># print the file names</span>
</span></span><span style="display:flex;"><span>$dupes
</span></span></code></pre></div><p>This script calculates a checksum for every file in the directory, recursively
passing through every folder inside the dir it was launched at (it accepts the
target through the first command line parameter as well).</p>
<p>As you might want to inspect the files before deleting them, this script simply
prints their names to the standard output. For a quick oneliner that would purge
every duplicate file found automatically, issue:</p>
<pre tabindex="0"><code>PS &gt; Remove-Duplicates.ps1 C:\Some\Path | Select-Object -ExpandProperty Dupe | Remove-Item
</code></pre>
    </main>
    
    <section>
        <span class="bold">Tags:</span>
        <ul class="tags">
        <li class="tag"><a href="https://tdem.in/tags/powershell/">PowerShell</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/windows/">Windows</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/file-management/">file management</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/hack/">hack</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/programming/">programming</a></li>
        
        </ul>
    </section>
    
</article>

        <footer>
            <hr>
            <small>
                <p>
                    &copy; 2024 <a href="https://tdem.in">Timur Demin</a>.
                    Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> using a theme based on
                    <a href="https://github.com/arjunkrishnababu96/basics" target="_blank">Basics</a>.
                </p>
                <p>
                    All content on this page is licensed under a <a rel="license" href="/LICENSE">Creative Commons Attribution
                        4.0 International License</a>, unless noticed otherwise.
                </p>
                
                <p>
                    The source code of this website is available <a target="_blank" href="https://github.com/tdemin/tdem.in">here</a>.
                </p>
                
            </small>
        </footer>
        
        </div>
    </body>
</html>
