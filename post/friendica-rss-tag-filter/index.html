<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono" rel="stylesheet"> 
        <title>Filtering Friendica posts in an RSS feed by tag - Timur Demin&#39;s Blog</title>
        <link rel="stylesheet" href="https://tdem.in/main.min.e362aa227211af09a948971525eec203b612c527d03a62e7ddaa6c3ac14d5ed4.css">
        <link rel="alternate" type="application/rss+xml" href="/index.xml">
        <meta property="og:title" content="Filtering Friendica posts in an RSS feed by tag" />
<meta property="og:description" content="The current version of Friendica doesn&rsquo;t appear to support filtering posts by
tag in an RSS
feed. Appending ?tag=XXX to an RSS feed URI seems to be silently ignored.
As I wanted a custom feed that only has music posts in it, I wrote a quick and
dirty feed crawler in Python/Flask that removes all posts that do not have a
single mention of the specified tag in it. The whole program only took 50
minutes to write." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tdem.in/post/friendica-rss-tag-filter/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-02-14T02:00:38+05:00" />
<meta property="article:modified_time" content="2020-02-14T02:00:38+05:00" />

        <link rel="me" href="https://github.com/tdemin">
        <link rel="webmention" href="https://webmention.io/tdem.in/webmention">
        <link rel="pingback" href="https://webmention.io/tdem.in/xmlrpc">
    </head>
    <body>
        <div class="container-horizontal">
        <nav class="navbar-top">
            <a class="navbar-top__item" href="/">Home</a>
            <a class="navbar-top__item" href="/projects">Projects</a>
            <a class="navbar-top__item" href="/post">Blog</a>
            <a class="navbar-top__item" href="/index.xml">RSS</a>
            <a class="navbar-top__item" href="/blog_index">Index</a>
        </nav>
        


<article>
    <h1>Filtering Friendica posts in an RSS feed by tag</h1>
    <time class="bold" datetime="2020-02-14T02:00:38">14 Feb 2020</time>

    <main>
        <p>The current version of Friendica <a href="https://libranet.de/display/0b6b25a8-185e-3d67-ae42-cb8788243360">doesn&rsquo;t appear to support filtering posts by
tag</a> in an RSS
feed. Appending <code>?tag=XXX</code> to an RSS feed URI seems to be silently ignored.</p>
<p>As I wanted a custom feed that only has music posts in it, I wrote a quick and
dirty feed crawler in Python/Flask that removes all posts that do not have a
single mention of the specified tag in it. The whole program only took 50
minutes to write.</p>
<p>After deployment the feed is available at
<code>/tag?token=some_token</code> where <code>tag</code> is the text we&rsquo;re searching for in the feed
content and <code>some_token</code> is whatever you set with <code>FRIENDICA_TOKEN</code> (only needed
so that Googlebot doesn&rsquo;t accidentally flood Friendica with requests).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">from</span> os <span style="color:#f92672">import</span> getenv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask, request, Response
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Flask(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TOKEN <span style="color:#f92672">=</span> getenv(<span style="color:#e6db74">&#34;FRIENDICA_TOKEN&#34;</span>, <span style="color:#e6db74">&#34;some_token&#34;</span>)
</span></span><span style="display:flex;"><span>URI <span style="color:#f92672">=</span> getenv(<span style="color:#e6db74">&#34;FRIENDICA_URI&#34;</span>, <span style="color:#e6db74">&#34;https://some.friendica.server.tld/dfrn_poll/username&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/&lt;text&gt;&#34;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;GET&#34;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">home_route</span>(text: str):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;token&#34;</span>) <span style="color:#f92672">!=</span> TOKEN:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;unauthorized&#34;</span>, <span style="color:#ae81ff">401</span>
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(URI)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> res<span style="color:#f92672">.</span>ok:
</span></span><span style="display:flex;"><span>        res<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;failed to retrieve data&#34;</span>, <span style="color:#ae81ff">500</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> BeautifulSoup(res<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf8&#34;</span>), features<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lxml&#34;</span>)
</span></span><span style="display:flex;"><span>    res<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> entry_tag <span style="color:#f92672">in</span> data<span style="color:#f92672">.</span>find_all(<span style="color:#e6db74">&#34;entry&#34;</span>):
</span></span><span style="display:flex;"><span>        content <span style="color:#f92672">=</span> entry_tag<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;content&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> content <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> text <span style="color:#f92672">in</span> str(content):
</span></span><span style="display:flex;"><span>                entry_tag<span style="color:#f92672">.</span>extract()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Response(data<span style="color:#f92672">.</span>encode()<span style="color:#f92672">.</span>decode()<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&lt;/body&gt;&lt;/html&gt;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&lt;html&gt;&lt;body&gt;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#f92672">.</span>encode(), mimetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;application/rss+xml&#34;</span>)
</span></span></code></pre></div>
    </main>
    
    <section>
        <span class="bold">Tags:</span>
        <ul class="tags">
        <li class="tag"><a href="https://tdem.in/tags/friendica/">Friendica</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/fediverse/">fediverse</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/rss/">RSS</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/flask/">Flask</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/python/">Python</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/programming/">programming</a></li>
        
        </ul>
    </section>
    
</article>

        <footer>
            <hr>
            <small>
                <p>
                    &copy; 2025 <a href="https://tdem.in">Timur Demin</a>.
                    Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> using a theme based on
                    <a href="https://github.com/arjunkrishnababu96/basics" target="_blank">Basics</a>.
                </p>
                <p>
                    All content on this page is licensed under a <a rel="license" href="/LICENSE">Creative Commons Attribution
                        4.0 International License</a>, unless noticed otherwise.
                </p>
                
                <p>
                    The source code of this website is available <a target="_blank" href="https://github.com/tdemin/tdem.in">here</a>.
                </p>
                
            </small>
        </footer>
        
        </div>
    </body>
</html>
