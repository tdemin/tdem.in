<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono" rel="stylesheet"> 
        <title>Configuring Yggdrasil with systemd-networkd - Timur Demin&#39;s Blog</title>
        <link rel="stylesheet" href="https://tdem.in/main.min.e362aa227211af09a948971525eec203b612c527d03a62e7ddaa6c3ac14d5ed4.css">
        <link rel="alternate" type="application/rss+xml" href="/index.xml">
        <meta property="og:title" content="Configuring Yggdrasil with systemd-networkd" />
<meta property="og:description" content="Yggdrasil, while being a great mesh networking software, doesn&rsquo;t have
that many learning resources on it. The docs on its website and a few
enthusiast-established wikis are probably everything you&rsquo;ll ever find on how to
set it up.
This is a simple recipe on how to configure Yggdrasil with systemd-networkd and
systemd-resolved while providing other devices on your local network with Ygg
addresses and allowing them to use Ygg." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tdem.in/post/yggdrasil-systemd/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-07-23T13:15:08+05:00" />
<meta property="article:modified_time" content="2020-07-23T13:15:08+05:00" />

        <link rel="me" href="https://github.com/tdemin">
        <link rel="webmention" href="https://webmention.io/tdem.in/webmention">
        <link rel="pingback" href="https://webmention.io/tdem.in/xmlrpc">
    </head>
    <body>
        <div class="container-horizontal">
        <nav class="navbar-top">
            <a class="navbar-top__item" href="/">Home</a>
            <a class="navbar-top__item" href="/projects">Projects</a>
            <a class="navbar-top__item" href="/post">Blog</a>
            <a class="navbar-top__item" href="/index.xml">RSS</a>
            <a class="navbar-top__item" href="/blog_index">Index</a>
        </nav>
        


<article>
    <h1>Configuring Yggdrasil with systemd-networkd</h1>
    <time class="bold" datetime="2020-07-23T13:15:08">23 Jul 2020</time>

    <main>
        <p><a href="https://yggdrasil-network.github.io">Yggdrasil</a>, while being a great mesh networking software, doesn&rsquo;t have
that many learning resources on it. The docs on its website and a few
enthusiast-established wikis are probably everything you&rsquo;ll ever find on how to
set it up.</p>
<p>This is a simple recipe on how to configure Yggdrasil with systemd-networkd and
systemd-resolved while providing other devices on your local network with Ygg
addresses and allowing them to use Ygg.</p>
<p>Consider the following setup:</p>
<ul>
<li>an always-on PC</li>
<li>a router to which the PC is connected</li>
<li>all other devices in LAN</li>
</ul>
<p>We want to deploy Yggdrasil on the PC and delegate the <code>300:XXXX:XXXX:XXXX::/64</code>
subnet provided by Ygg to other devices. This guide assumes you have already
<a href="https://yggdrasil-network.github.io/configuration.html">set up Yggdrasil</a> on your Linux box.</p>
<p>We configure our usual connection with <code>/etc/systemd/network/10-eth0.network</code>:</p>
<pre tabindex="0"><code>[Match]
# wired connection device name
Name=eth0

[Network]
# Address/Gateway, or DHCP=yes, or whatever else you might have configured
# your wired connection with
...
# the address inside the 300::/8 subnet; the host will use this address inside
# the wired network
Address=300:XXXX:XXXX:XXXX::1/64
# enable IPv6 router
IPv6PrefixDelegation=static
IPForward=ipv6
# the DNS we want to use for clearnet connections
DNS=...

[IPv6Prefix]
# the prefix advertised to other devices by the machine
Prefix=300:XXXX:XXXX:XXXX::/64

[IPv6PrefixDelegation]
EmitDNS=yes
# should be an Ygg DNS address, you might prefer to unset this or use your own
# DNS server inside Yggdrasil
DNS=301:2522::53
RouterLifetimeSec=3600 # should always be set

[IPv6RoutePrefix]
# the route to Ygg to propagate to devices
Route=200::/7
</code></pre><p>Now let&rsquo;s configure Yggdrasil TUN device with
<code>/etc/systemd/network/40-tun0.network</code>:</p>
<pre tabindex="0"><code>[Match]
# Yggdrasil TUN device name, same as IfName in /etc/yggdrasil.conf if set
Name=tun0

[Network]
# useless with Yggdrasil
LinkLocalAddressing=no
# some DNS inside Yggdrasil to resolve .ygg addresses and alike; you might want
# to specify your own address here
DNS=301:2522::53
DefaultRouteOnDevice=no

[Address]
# the /128 address Ygg provides us with
Address=200:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX/128

[Route]
# route packets to Yggdrasil
Destination=200::/7
Scope=global
</code></pre><p>In this schema systemd-resolved will only use Ygg DNS for sites we browse from
Ygg, and whatever else we configure in <code>/etc/systemd/resolved.conf</code> by default.
This allows the machine to properly resolve <code>.ygg</code> domains while falling back
to system default DNS for everything outside Yggdrasil.</p>
<p>Every other IPv6-enabled device on your LAN will now receive Ygg addresses and
will be able to connect to Yggdrasil while your machine is on. However, be aware
that end-to-end encryption Yggdrasil provides is terminated at your Yggdrasil
router. You should also consider setting up a firewall to protect your other
devices.</p>
    </main>
    
    <section>
        <span class="bold">Tags:</span>
        <ul class="tags">
        <li class="tag"><a href="https://tdem.in/tags/yggdrasil/">Yggdrasil</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/systemd/">systemd</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/systemd-networkd/">systemd-networkd</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/systemd-resolved/">systemd-resolved</a></li>,
        
        <li class="tag"><a href="https://tdem.in/tags/linux/">Linux</a></li>
        
        </ul>
    </section>
    
</article>

        <footer>
            <hr>
            <small>
                <p>
                    &copy; 2025 <a href="https://tdem.in">Timur Demin</a>.
                    Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> using a theme based on
                    <a href="https://github.com/arjunkrishnababu96/basics" target="_blank">Basics</a>.
                </p>
                <p>
                    All content on this page is licensed under a <a rel="license" href="/LICENSE">Creative Commons Attribution
                        4.0 International License</a>, unless noticed otherwise.
                </p>
                
                <p>
                    The source code of this website is available <a target="_blank" href="https://github.com/tdemin/tdem.in">here</a>.
                </p>
                
            </small>
        </footer>
        
        </div>
    </body>
</html>
